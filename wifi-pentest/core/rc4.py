"""
RC4 Stream Cipher Implementation
Educational Purpose Only
"""

class RC4:
    """RC4 stream cipher implementation"""
    
    def __init__(self, key):
        """Initialize RC4 with given key"""
        self.key = key
        self.S = list(range(256))
        self.reset()
    
    def reset(self):
        """Reset and initialize the RC4 state"""
        j = 0
        for i in range(256):
            j = (j + self.S[i] + self.key[i % len(self.key)]) % 256
            self.S[i], self.S[j] = self.S[j], self.S[i]
        self.i = 0
        self.j = 0
    
    def keystream_byte(self):
        """Generate one keystream byte"""
        self.i = (self.i + 1) % 256
        self.j = (self.j + self.S[self.i]) % 256
        self.S[self.i], self.S[self.j] = self.S[self.j], self.S[self.i]
        return self.S[(self.S[self.i] + self.S[self.j]) % 256]
    
    def crypt(self, data):
        """Encrypt/decrypt data using RC4"""
        self.reset()
        result = bytearray()
        for byte in data:
            result.append(byte ^ self.keystream_byte())
        return bytes(result)